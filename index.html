<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Sudan IDPs Dashboard</title>
  
  <!-- External CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-color: #4361ee;
      --primary-light: #eef2ff;
      --secondary-color: #f72585;
      --secondary-light: #fff0f6;
      --light-gray: #f8fafc;
      --medium-gray: #e2e8f0;
      --dark-gray: #64748b;
      --darker-gray: #334155;
      --border-radius: 12px;
      --border-radius-sm: 8px;
      --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --header-height: 70px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f1f5f9;
      height: 100vh;
      overflow: auto;
    }

    .app-header {
      background-color: white;
      padding: 0 20px;
      box-shadow: var(--box-shadow);
      height: var(--header-height);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .app-title {
      font-size: 1.3rem;
      color: var(--primary-color);
    }
    
    .main-container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .dashboard-section {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
    }
    
    .section-header {
      padding: 12px 15px;
      background: var(--light-gray);
      border-bottom: 1px solid var(--medium-gray);
      display: flex;
      justify-content: space-between;
    }
    
    .section-title {
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .section-content {
      padding: 15px;
    }
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .metric-card {
      background: var(--light-gray);
      border-radius: var(--border-radius-sm);
      padding: 12px;
      text-align: center;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .metric-card .value {
      font-size: 20px;
      font-weight: 700;
      margin: 5px 0;
    }
    
    .metric-card .label {
      font-size: 14px;
      color: var(--dark-gray);
    }
    
    .metric-card .change {
      font-size: 12px;
      color: var(--dark-gray);
    }
    
    .metric-card .sub-value {
      font-size: 14px;
      color: var(--dark-gray);
    }
    
    .idps-metric {
      border-top: 3px solid var(--primary-color);
    }
    
    .idps-metric .value {
      color: var(--primary-color);
    }
    
    .chart-container {
      height: 400px;  /* Increased height */
      margin-top: 10px;
      position: relative;
    }
    
    .chart-container-sm {
      height: 350px;  /* Increased height */
      margin-top: 10px;
      position: relative;
    }
    
    .full-width-section {
      grid-column: 1 / -1;  /* Makes section span full width */
    }
    
    @media (max-width: 768px) {
      .metrics-grid {
        grid-template-columns: 1fr;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .chart-container {
        height: 350px;
      }
      
      .chart-container-sm {
        height: 300px;
      }
    }
  </style>
</head>

<body>
  <header class="app-header">
    <h1 class="app-title">Sudan IDPs Dashboard</h1>
  </header>
  
  <div class="main-container">
    <div class="dashboard-grid">
      <!-- Summary Section -->
      <div class="dashboard-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-people-arrows"></i> IDPs Summary
          </h2>
        </div>
        <div class="section-content">
          <div class="metrics-grid">
            <div class="metric-card idps-metric">
              <div class="label">Total IDPs</div>
              <div class="value">9.84M</div>
              <div class="change">+12% since Jan</div>
            </div>
            <div class="metric-card">
              <div class="label">Most Affected State</div>
              <div class="value">South Darfur</div>
              <div class="sub-value">1.84M IDPs (18.7%)</div>
            </div>
            <div class="metric-card">
              <div class="label">States Affected</div>
              <div class="value">18</div>
              <div class="sub-value">100% of states</div>
            </div>
            <div class="metric-card">
              <div class="label">Localities</div>
              <div class="value">178</div>
              <div class="sub-value">9,831 locations</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Distribution Pie Chart - Now full width -->
      <div class="dashboard-section full-width-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-chart-pie"></i> IDPs Distribution by State
          </h2>
        </div>
        <div class="section-content">
          <div class="chart-container">
            <canvas id="idpsPieChart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Top States Bar Chart - Now full width -->
      <div class="dashboard-section full-width-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-chart-bar"></i> Top States by IDP Count
          </h2>
        </div>
        <div class="section-content">
          <div class="chart-container">
            <canvas id="idpsBarChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <script>
    // State IDPs Data
    const stateData = [
      { state: 'South Darfur', code: 'SD03', localities: 21, locations: 158, idps: 1842960 },
      { state: 'North Darfur', code: 'SD02', localities: 17, locations: 565, idps: 1794860 },
      { state: 'Central Darfur', code: 'SD06', localities: 9, locations: 143, idps: 970797 },
      { state: 'East Darfur', code: 'SD05', localities: 9, locations: 53, idps: 802944 },
      { state: 'Blue Nile', code: 'SD08', localities: 7, locations: 242, idps: 405553 },
      { state: 'West Darfur', code: 'SD04', localities: 8, locations: 160, idps: 347342 },
      { state: 'South Kordofan', code: 'SD07', localities: 14, locations: 504, idps: 392118 },
      { state: 'West Kordofan', code: 'SD18', localities: 14, locations: 719, idps: 395260 },
      { state: 'Gedaref', code: 'SD12', localities: 12, locations: 656, idps: 475315 },
      { state: 'River Nile', code: 'SD16', localities: 7, locations: 1283, idps: 585975 },
      { state: 'White Nile', code: 'SD09', localities: 9, locations: 1319, idps: 543761 },
      { state: 'Northern', code: 'SD17', localities: 7, locations: 646, idps: 530127 },
      { state: 'Khartoum', code: 'SD01', localities: 7, locations: 547, idps: 230326 },
      { state: 'North Kordofan', code: 'SD13', localities: 8, locations: 640, idps: 218478 },
      { state: 'Aj Jazirah', code: 'SD15', localities: 8, locations: 1831, idps: 139842 },
      { state: 'Red Sea', code: 'SD10', localities: 10, locations: 310, idps: 178582 },
      { state: 'Kassala', code: 'SD11', localities: 11, locations: 325, idps: 118605 },
      { state: 'Sennar', code: 'SD14', localities: 7, locations: 420, idps: 92484 }
    ];

    // Calculate totals and percentages
    const totalIDPs = stateData.reduce((sum, state) => sum + state.idps, 0);
    
    // Sort by IDPs descending
    stateData.sort((a, b) => b.idps - a.idps);

    // Get top 6 states for pie chart (others grouped)
    const topStates = stateData.slice(0, 6);
    const otherStates = stateData.slice(6);
    const otherTotal = otherStates.reduce((sum, state) => sum + state.idps, 0);

    // Format numbers
    const formatNumber = (num) => {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    };

    const formatShort = (value) => {
      if (value >= 1000000) return (value / 1000000).toFixed(1) + "M";
      if (value >= 1000) return (value / 1000).toFixed(0) + "K";
      return formatNumber(value);
    };

    // Initialize Pie Chart
    const idpsPieCtx = document.getElementById('idpsPieChart');
    if (idpsPieCtx) {
      new Chart(idpsPieCtx, {
        type: 'pie',
        data: {
          labels: [...topStates.map(state => state.state), 'Other 12 States'],
          datasets: [{
            data: [...topStates.map(state => state.idps), otherTotal],
            backgroundColor: [
              '#3a0ca3', '#4361ee', '#4895ef', '#4cc9f0', '#f72585', '#b5179e', '#7209b7'
            ],
            borderColor: '#fff',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                boxWidth: 12,
                padding: 20,
                font: {
                  size: 12
                }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw;
                  const percentage = Math.round((value / totalIDPs) * 100);
                  return `${label}: ${formatShort(value)} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }

    // Initialize Bar Chart (Top 10 States)
    const idpsBarCtx = document.getElementById('idpsBarChart');
    const top10States = stateData.slice(0, 10);
    
    if (idpsBarCtx) {
      new Chart(idpsBarCtx, {
        type: 'bar',
        data: {
          labels: top10States.map(state => state.state),
          datasets: [{
            label: 'IDPs',
            data: top10States.map(state => state.idps),
            backgroundColor: '#4361ee',
            borderColor: '#3a0ca3',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `IDPs: ${formatNumber(context.raw)} (${((context.raw / totalIDPs) * 100).toFixed(1)}%)`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return formatShort(value);
                }
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
